{% extends "sidebar_asset_management.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{#{% block header %}#}
{#<link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/repo.css') }}">#}
{#{% endblock %}#}
{#{% block head %}#}
{##}
{#{% endblock %}#}
{% block script %}
    <script>
        var $table = $('#table')

        function loadingTemplate() {
            return '<i class="fa fa-spinner fa-spin fa-fw fa-2x"></i>'
        }

        function operateFormatter(value, row, index) {
            return [
                {#'<a class="edit" href="javascript:void(0)" title="Edit">',#}
                {#'<i class="fa fa-edit"></i>',#}
                {#'</a>  ',#}
                '<button type="button" class="btn btn-primary fa fa-edit" data-toggle="modal" data-target="#editModal">\n' +
                '<span class= "custom-font">Edit</span>' +
                '</button>'
            ].join('')
        }

        function populateEditFields(row) {
            $("#editForm").find("#id").val(row.id)
            $("#editForm").find("#name").val(row.name)
        }


        window.operateEvents = {
            'click .fa-edit': function (e, value, row, index) {
                populateEditFields(row)
                {#alert('You click like action, row: ' + JSON.stringify(row))#}
            }
        }

        $(function () {
            var data = {{ repo_threats | safe }};
            console.log(data)
            $table.bootstrapTable({data: data});
        })
    </script>
{% endblock %}

{% block content %}
    <h1>Repo Threats </h1>
    <hr/>
    <div id="toolbar">
        <button id="remove" class="btn btn-danger" disabled>
            <i class="fa fa-trash"></i> Delete
        </button>
    </div>
    <table
            id="table"
            data-toolbar="#toolbar"
            data-search="true"
            data-search-on-enter-key="true"
            data-show-search-button="true"
            data-show-refresh="true"
            data-show-toggle="true"
            data-show-fullscreen="true"
            data-show-columns="true"
            data-show-columns-toggle-all="true"
            data-loading-template="loadingTemplate"
            data-pagination="true"
            data-page-list="[10, 25, 50, 100, all]"
            show-button-icons="true"
            data-row-style="rowStyle"
    >
        <thead>
        <tr>
            <th data-field="id" data-sortable="true">ID</th>
            <th data-field="name" data-sortable="true">Name</th>
            <th data-field="CAPEC_id" data-sortable="true">CAPEC</th>
{#            <th data-field="likelihood" data-sortable="true">Likelihood</th>#}
{#            <th data-field="impact" data-sortable="true">Impact</th>#}

            <th data-field="operate" data-formatter="operateFormatter" data-events="operateEvents">Item Price</th>
        </tr>
        </thead>
    </table>
    <hr/>
    <h2>Add New Threat</h2>
    <div class="row dashboard-row">
        <div class="col-6">
            {#            <div class="row flex-grow custom-select-column-header">#}
            <h3> Likelihood &lt Medium 50% &gt </h3>
            <h4> Threat Agent Factory </h4>
            <label for="formControlRange">Skill Level</label>
            <input type="range" class="form-control-range" id="formControlRange">
            <label for="formControlRange">Motive</label>
            <input type="range" class="form-control-range" id="formControlRange">
            <label for="formControlRange">Opportunity</label>
            <input type="range" class="form-control-range" id="formControlRange">
            <h4> Vulnerability Factors</h4>
            <label for="formControlRange">Ease of discovery</label>
            <input type="range" class="form-control-range" id="formControlRange">
            <label for="formControlRange">Ease of exploit</label>
            <input type="range" class="form-control-range" id="formControlRange">
            <label for="formControlRange">Awareness</label>
            <input type="range" class="form-control-range" id="formControlRange">
            {#            </div>#}

        </div>
        <div class="col-6">
            <form action="/repo/threats/" method="post" novalidate>
                {{ wtf.quick_form(new_threat_form) }}
                {#        <p>{{ wtf.form_field(new_actor_form.submit()) }}</p>#}
                </p>
            </form>
            {#            <div class="row flex-grow custom-select-column-header">#}
            {#            <h3> Impact &lt Medium 59% &gt </h3>#}
            {#            <h4> Technical Impact Factor</h4>#}
            {#            <label for="formControlRange">Loss of confidentiality</label>#}
            {#            <input type="range" class="form-control-range" id="formControlRange">#}
            {#            <label for="formControlRange">Loss of integrity</label>#}
            {#            <input type="range" class="form-control-range" id="formControlRange">#}
            {#            <label for="formControlRange">Loss of availability</label>#}
            {#            <input type="range" class="form-control-range" id="formControlRange">#}
            {#            <h4> Business Impact Factors</h4>#}
            {#            <label for="formControlRange">Financial Damage</label>#}
            {#            <input type="range" class="form-control-range" id="formControlRange">#}
            {#            <label for="formControlRange">Reputation Damage</label>#}
            {#            <input type="range" class="form-control-range" id="formControlRange">#}
            {#            <label for="formControlRange">Non-compliance</label>#}
            {#            <input type="range" class="form-control-range" id="formControlRange">#}
            {#            </div>#}

        </div>

    </div>



    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Actor Entry</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row dashboard-row">
                        <div class="col-6">
                            {#            <div class="row flex-grow custom-select-column-header">#}
                            <h3> Likelihood &lt Medium 50% &gt </h3>
                            <h4> Threat Agent Factory </h4>
                            <label for="formControlRange">Skill Level</label>
                            <input type="range" class="form-control-range" id="formControlRange">
                            <label for="formControlRange">Motive</label>
                            <input type="range" class="form-control-range" id="formControlRange">
                            <label for="formControlRange">Opportunity</label>
                            <input type="range" class="form-control-range" id="formControlRange">
                            <h4> Vulnerability Factors</h4>
                            <label for="formControlRange">Ease of discovery</label>
                            <input type="range" class="form-control-range" id="formControlRange">
                            <label for="formControlRange">Ease of exploit</label>
                            <input type="range" class="form-control-range" id="formControlRange">
                            <label for="formControlRange">Awareness</label>
                            <input type="range" class="form-control-range" id="formControlRange">
                            {#            </div>#}

                        </div>
                        <div class="col-6">
                            <form id="editForm" action="/repo/threats/" method="post" class="form form-horizontal"
                                  method="post"
                                  role="form" novalidate>
                                {{ new_threat_form.hidden_tag() }}

                                {{ wtf.form_field(new_threat_form.name) }}
                                {{ wtf.form_field(new_threat_form.capec) }}
                                {{ wtf.form_field(new_threat_form.submit) }}
                            </form>
                            {#            <div class="row flex-grow custom-select-column-header">#}
                            {#                            <h3> Impact &lt Medium 59% &gt </h3>#}
                            {#                            <h4> Technical Impact Factor</h4>#}
                            {#                            <label for="formControlRange">Loss of confidentiality</label>#}
                            {#                            <input type="range" class="form-control-range" id="formControlRange">#}
                            {#                            <label for="formControlRange">Loss of integrity</label>#}
                            {#                            <input type="range" class="form-control-range" id="formControlRange">#}
                            {#                            <label for="formControlRange">Loss of availability</label>#}
                            {#                            <input type="range" class="form-control-range" id="formControlRange">#}
                            {#                            <h4> Business Impact Factors</h4>#}
                            {#                            <label for="formControlRange">Financial Damage</label>#}
                            {#                            <input type="range" class="form-control-range" id="formControlRange">#}
                            {#                            <label for="formControlRange">Reputation Damage</label>#}
                            {#                            <input type="range" class="form-control-range" id="formControlRange">#}
                            {#                            <label for="formControlRange">Non-compliance</label>#}
                            {#                            <input type="range" class="form-control-range" id="formControlRange">#}
                            {#            </div>#}

                        </div>

                    </div>

                    {#                    {{ wtf.quick_form(new_actor_form) }}#}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    {#                    <button type="button" class="btn btn-primary">Save changes</button>#}
                </div>
            </div>
        </div>
    </div>

{% endblock %}
